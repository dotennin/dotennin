---
title: Compose on Kubernetes サンプル
date: 2019-11-26 12:26:26
tags:
  - Docker
  - Kubernetes
---

<span style="background-color: rgba(0 , 0 , 0 , 0.03); color: #4d4d4d; font-family: &quot;monaco&quot; , &quot;consolas&quot; , &quot;courier new&quot; , &quot;courier&quot; , monospace , sans-serif; font-size: 13.5px;">docker-compose.yml</span>を作る<br />

<pre class="code lang-yaml" data-lang="yaml" data-unlink="" style="background: rgb(250, 250, 250); border-radius: 3px; border: 0px; box-shadow: rgba(0, 0, 0, 0.2) 0px 0px 5px inset; color: #4d4d4d; font-family: Monaco, Consolas, &quot;Courier New&quot;, Courier, monospace, sans-serif; font-size: 13px; outline: 0px; overflow: auto hidden; padding: 10px; vertical-align: baseline;"><span class="synIdentifier" style="background: transparent; border: 0px; color: #51cfcf; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline;">version</span><span class="synSpecial" style="background: transparent; border: 0px; color: #c000c0; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline;">:</span> <span class="synConstant" style="background: transparent; border: 0px; color: #ff6666; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline;">'3.3'</span>

<span class="synIdentifier" style="background: transparent; border: 0px; color: #51cfcf; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline;">services</span><span class="synSpecial" style="background: transparent; border: 0px; color: #c000c0; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline;">:</span>

  <span class="synIdentifier" style="background: transparent; border: 0px; color: #51cfcf; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline;">db</span><span class="synSpecial" style="background: transparent; border: 0px; color: #c000c0; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline;">:</span>
    <span class="synIdentifier" style="background: transparent; border: 0px; color: #51cfcf; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline;">build</span><span class="synSpecial" style="background: transparent; border: 0px; color: #c000c0; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline;">:</span> db
    <span class="synIdentifier" style="background: transparent; border: 0px; color: #51cfcf; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline;">image</span><span class="synSpecial" style="background: transparent; border: 0px; color: #c000c0; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline;">:</span> dockersamples/k8s-wordsmith-db

  <span class="synIdentifier" style="background: transparent; border: 0px; color: #51cfcf; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline;">words</span><span class="synSpecial" style="background: transparent; border: 0px; color: #c000c0; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline;">:</span>
    <span class="synIdentifier" style="background: transparent; border: 0px; color: #51cfcf; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline;">build</span><span class="synSpecial" style="background: transparent; border: 0px; color: #c000c0; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline;">:</span> words
    <span class="synIdentifier" style="background: transparent; border: 0px; color: #51cfcf; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline;">image</span><span class="synSpecial" style="background: transparent; border: 0px; color: #c000c0; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline;">:</span> dockersamples/k8s-wordsmith-api
    <span class="synIdentifier" style="background: transparent; border: 0px; color: #51cfcf; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline;">deploy</span><span class="synSpecial" style="background: transparent; border: 0px; color: #c000c0; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline;">:</span>
      <span class="synIdentifier" style="background: transparent; border: 0px; color: #51cfcf; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline;">replicas</span><span class="synSpecial" style="background: transparent; border: 0px; color: #c000c0; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline;">:</span> <span class="synConstant" style="background: transparent; border: 0px; color: #ff6666; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline;">5</span>

  <span class="synIdentifier" style="background: transparent; border: 0px; color: #51cfcf; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline;">web</span><span class="synSpecial" style="background: transparent; border: 0px; color: #c000c0; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline;">:</span>
    <span class="synIdentifier" style="background: transparent; border: 0px; color: #51cfcf; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline;">build</span><span class="synSpecial" style="background: transparent; border: 0px; color: #c000c0; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline;">:</span> web
    <span class="synIdentifier" style="background: transparent; border: 0px; color: #51cfcf; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline;">image</span><span class="synSpecial" style="background: transparent; border: 0px; color: #c000c0; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline;">:</span> dockersamples/k8s-wordsmith-web
    <span class="synIdentifier" style="background: transparent; border: 0px; color: #51cfcf; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline;">ports</span><span class="synSpecial" style="background: transparent; border: 0px; color: #c000c0; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline;">:</span>
     <span class="synStatement" style="background: transparent; border: 0px; color: #d88a17; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline;">- </span><span class="synConstant" style="background: transparent; border: 0px; color: #ff6666; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline;">"33000:80"</span></pre>
<br />
<pre class="code" data-lang="" data-unlink="" style="background: rgb(250, 250, 250); border-radius: 3px; border: 0px; box-shadow: rgba(0, 0, 0, 0.2) 0px 0px 5px inset; color: #4d4d4d; font-family: Monaco, Consolas, &quot;Courier New&quot;, Courier, monospace, sans-serif; font-size: 13px; outline: 0px; overflow: auto hidden; padding: 10px; vertical-align: baseline;">docker stack deploy --orchestrator=kubernetes -c docker-compose.yml composek8s</pre>
<br />
実行結果<br />
<pre class="code" data-lang="" data-unlink="" style="background: rgb(250, 250, 250); border-radius: 3px; border: 0px; box-shadow: rgba(0, 0, 0, 0.2) 0px 0px 5px inset; color: #4d4d4d; font-family: Monaco, Consolas, &quot;Courier New&quot;, Courier, monospace, sans-serif; font-size: 13px; outline: 0px; overflow: auto hidden; padding: 10px; vertical-align: baseline;"><div style="color: black; font-family: Times; font-size: medium; white-space: normal;">
Ignoring unsupported options: build</div>
<div style="color: black; font-family: Times; font-size: medium; white-space: normal;">
</div>
<div style="color: black; font-family: Times; font-size: medium; white-space: normal;">
service "db": build is ignored</div>
<div style="color: black; font-family: Times; font-size: medium; white-space: normal;">
service "words": build is ignored</div>
<div style="color: black; font-family: Times; font-size: medium; white-space: normal;">
service "web": build is ignored</div>
<div style="color: black; font-family: Times; font-size: medium; white-space: normal;">
Waiting for the stack to be stable and running...</div>
<div style="color: black; font-family: Times; font-size: medium; white-space: normal;">
db: Ready<span style="white-space: pre;">  </span>[pod status: 1/1 ready, 0/1 pending, 0/1 failed]</div>
<div style="color: black; font-family: Times; font-size: medium; white-space: normal;">
db: Ready<span style="white-space: pre;">  </span>[pod status: 1/1 ready, 0/1 pending, 0/1 failed]</div>
<div style="color: black; font-family: Times; font-size: medium; white-space: normal;">
web: Ready<span style="white-space: pre;">  </span>[pod status: 1/1 ready, 0/1 pending, 0/1 failed]</div>
<div style="color: black; font-family: Times; font-size: medium; white-space: normal;">
words: Ready<span style="white-space: pre;">  </span>[pod status: 1/5 ready, 4/5 pending, 0/5 failed]</div>
<div style="color: black; font-family: Times; font-size: medium; white-space: normal;">
</div>
<div style="color: black; font-family: Times; font-size: medium; white-space: normal;">
Stack composek8s is stable and running</div>
</pre>
<br />
ブラウザからアクセスできるようになります<span style="background-color: rgba(0 , 0 , 0 , 0.03); color: #4d4d4d; font-family: &quot;monaco&quot; , &quot;consolas&quot; , &quot;courier new&quot; , &quot;courier&quot; , monospace , sans-serif; font-size: 13.5px;">http://localhost:33000</span>

<br />
<span style="background-color: rgba(0 , 0 , 0 , 0.03); color: #4d4d4d; font-family: &quot;monaco&quot; , &quot;consolas&quot; , &quot;courier new&quot; , &quot;courier&quot; , monospace , sans-serif; font-size: 13.5px;"><br /></span>
実行状況を調べてみます<br />
<pre class="code" data-lang="" data-unlink="" style="background: rgb(250, 250, 250); border-radius: 3px; border: 0px; box-shadow: rgba(0, 0, 0, 0.2) 0px 0px 5px inset; color: #4d4d4d; font-family: monaco, consolas, &quot;courier new&quot;, courier, monospace, sans-serif; font-size: 13px; outline: 0px; overflow: auto hidden; padding: 10px; vertical-align: baseline;"><div style="color: black; font-family: Times; font-size: medium; white-space: normal;">
<span style="color: #4d4d4d; font-family: &quot;monaco&quot; , &quot;consolas&quot; , &quot;courier new&quot; , &quot;courier&quot; , monospace , sans-serif; font-size: 13.5px;"># docker stack ps --orchestrator=kubernetes composek8s</span><br />
<span style="color: #4d4d4d; font-family: &quot;monaco&quot; , &quot;consolas&quot; , &quot;courier new&quot; , &quot;courier&quot; , monospace , sans-serif;"><span style="font-size: 13.5px;">ID&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; NAME&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; IMAGE&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;NODE&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; DESIRED STATE&nbsp; &nbsp; &nbsp; &nbsp;CURRENT STATE&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ERROR&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;PORTS</span></span><br />
<span style="color: #4d4d4d; font-family: &quot;monaco&quot; , &quot;consolas&quot; , &quot;courier new&quot; , &quot;courier&quot; , monospace , sans-serif;"><span style="font-size: 13.5px;">598abba7-0f6&nbsp; &nbsp; &nbsp; &nbsp; composek8s_db-74444fddf7-s8nxf&nbsp; &nbsp; &nbsp; dockersamples/k8s-wordsmith-db&nbsp; &nbsp; docker-desktop&nbsp; &nbsp; &nbsp; Running&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Running 4 minutes ago</span></span><br />
<span style="color: #4d4d4d; font-family: &quot;monaco&quot; , &quot;consolas&quot; , &quot;courier new&quot; , &quot;courier&quot; , monospace , sans-serif;"><span style="font-size: 13.5px;">598f1b70-0f6&nbsp; &nbsp; &nbsp; &nbsp; composek8s_web-6d968c7bf6-mxjxt&nbsp; &nbsp; &nbsp;dockersamples/k8s-wordsmith-web&nbsp; &nbsp;docker-desktop&nbsp; &nbsp; &nbsp; Running&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Running 4 minutes ago&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;*:0-&gt;80/tcp</span></span><br />
<span style="color: #4d4d4d; font-family: &quot;monaco&quot; , &quot;consolas&quot; , &quot;courier new&quot; , &quot;courier&quot; , monospace , sans-serif;"><span style="font-size: 13.5px;">59931520-0f6&nbsp; &nbsp; &nbsp; &nbsp; composek8s_words-58bcc78668-2fpkt&nbsp; &nbsp;dockersamples/k8s-wordsmith-api&nbsp; &nbsp;docker-desktop&nbsp; &nbsp; &nbsp; Running&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Running 4 minutes ago</span></span><br />
<span style="color: #4d4d4d; font-family: &quot;monaco&quot; , &quot;consolas&quot; , &quot;courier new&quot; , &quot;courier&quot; , monospace , sans-serif;"><span style="font-size: 13.5px;">5994ca2c-0f6&nbsp; &nbsp; &nbsp; &nbsp; composek8s_words-58bcc78668-b8spk&nbsp; &nbsp;dockersamples/k8s-wordsmith-api&nbsp; &nbsp;docker-desktop&nbsp; &nbsp; &nbsp; Running&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Running 4 minutes ago</span></span><br />
<span style="color: #4d4d4d; font-family: &quot;monaco&quot; , &quot;consolas&quot; , &quot;courier new&quot; , &quot;courier&quot; , monospace , sans-serif;"><span style="font-size: 13.5px;">59984bde-0f6&nbsp; &nbsp; &nbsp; &nbsp; composek8s_words-58bcc78668-q4675&nbsp; &nbsp;dockersamples/k8s-wordsmith-api&nbsp; &nbsp;docker-desktop&nbsp; &nbsp; &nbsp; Running&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Running 4 minutes ago</span></span><br />
<span style="color: #4d4d4d; font-family: &quot;monaco&quot; , &quot;consolas&quot; , &quot;courier new&quot; , &quot;courier&quot; , monospace , sans-serif;"><span style="font-size: 13.5px;">5994b923-0f6&nbsp; &nbsp; &nbsp; &nbsp; composek8s_words-58bcc78668-v5b7s&nbsp; &nbsp;dockersamples/k8s-wordsmith-api&nbsp; &nbsp;docker-desktop&nbsp; &nbsp; &nbsp; Running&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Running 4 minutes ago</span></span><br />
<span style="color: #4d4d4d; font-family: &quot;monaco&quot; , &quot;consolas&quot; , &quot;courier new&quot; , &quot;courier&quot; , monospace , sans-serif;"><span style="background-color: rgba(0, 0, 0, 0.03); font-size: 13.5px;"></span></span>

<span style="color: #4d4d4d; font-family: &quot;monaco&quot; , &quot;consolas&quot; , &quot;courier new&quot; , &quot;courier&quot; , monospace , sans-serif;"><span style="font-size: 13.5px;">59983152-0f6&nbsp; &nbsp; &nbsp; &nbsp; composek8s_words-58bcc78668-z92cj&nbsp; &nbsp;dockersamples/k8s-wordsmith-api&nbsp; &nbsp;docker-desktop&nbsp; &nbsp; &nbsp; Running&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Running 4 minutes ago</span></span><br />
<span style="color: #4d4d4d; font-family: &quot;monaco&quot; , &quot;consolas&quot; , &quot;courier new&quot; , &quot;courier&quot; , monospace , sans-serif;"><span style="font-size: 13.5px;">
</span></span>
<br />

<div style="font-family: Times;">
<span style="color: #4d4d4d; font-family: &quot;monaco&quot; , &quot;consolas&quot; , &quot;courier new&quot; , &quot;courier&quot; , monospace , sans-serif;"><span style="font-size: 13.5px;"># docker stack services --orchestrator=kubernetes composek8s</span></span></div>
<div style="font-family: Times;">
<span style="color: #4d4d4d; font-family: &quot;monaco&quot; , &quot;consolas&quot; , &quot;courier new&quot; , &quot;courier&quot; , monospace , sans-serif;"><span style="font-size: 13.5px;">ID&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; NAME&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; MODE&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; REPLICAS&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; IMAGE&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;PORTS</span></span></div>
<div style="font-family: Times;">
<span style="color: #4d4d4d; font-family: &quot;monaco&quot; , &quot;consolas&quot; , &quot;courier new&quot; , &quot;courier&quot; , monospace , sans-serif;"><span style="font-size: 13.5px;">598fcb50-0f6&nbsp; &nbsp; &nbsp; &nbsp; composek8s_db&nbsp; &nbsp; &nbsp; &nbsp;replicated&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1/1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;dockersamples/k8s-wordsmith-db</span></span></div>
<div style="font-family: Times;">
<span style="color: #4d4d4d; font-family: &quot;monaco&quot; , &quot;consolas&quot; , &quot;courier new&quot; , &quot;courier&quot; , monospace , sans-serif;"><span style="font-size: 13.5px;">5992bb76-0f6&nbsp; &nbsp; &nbsp; &nbsp; composek8s_web&nbsp; &nbsp; &nbsp; replicated&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1/1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;dockersamples/k8s-wordsmith-web&nbsp; &nbsp;*:33000-&gt;80/tcp</span></span></div>
<div style="font-family: Times;">
<span style="font-size: 13.5px;"><span style="color: #4d4d4d; font-family: &quot;monaco&quot; , &quot;consolas&quot; , &quot;courier new&quot; , &quot;courier&quot; , monospace , sans-serif; font-size: 13.5px;"></span></span></div>
<div style="font-family: Times;">
<span style="color: #4d4d4d; font-family: &quot;monaco&quot; , &quot;consolas&quot; , &quot;courier new&quot; , &quot;courier&quot; , monospace , sans-serif;"><span style="font-size: 13.5px;">599e9c71-0f6&nbsp; &nbsp; &nbsp; &nbsp; composek8s_words&nbsp; &nbsp; replicated&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 5/5&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;dockersamples/k8s-wordsmith-api</span></span></div>
</div>
</pre>
<span style="color: #4d4d4d; font-family: &quot;monaco&quot; , &quot;consolas&quot; , &quot;courier new&quot; , &quot;courier&quot; , monospace , sans-serif; font-size: 13.5px;"> </span><br />
<span style="background-color: white; color: #4d4d4d; font-family: &quot;titilliumtext22lregular&quot; , &quot;ヒラギノ角ゴ pro w3&quot; , &quot;hiragino kaku gothic pro&quot; , , &quot;meiryo&quot; , &quot;ｍｓ ｐゴシック&quot; , &quot;ms pgothic&quot; , sans-serif; font-size: 15px;">別途&nbsp;</span><code style="background: rgba(0, 0, 0, 0.03); border-radius: 3px; border: 1px solid rgba(0, 0, 0, 0.08); color: #4d4d4d; font-family: Monaco, Consolas, &quot;Courier New&quot;, Courier, monospace, sans-serif; font-size: 13.5px; margin: 0px 2px; outline: 0px; padding: 0px 5px; vertical-align: baseline;">kubectl get all</code><span style="background-color: white; color: #4d4d4d; font-family: &quot;titilliumtext22lregular&quot; , &quot;ヒラギノ角ゴ pro w3&quot; , &quot;hiragino kaku gothic pro&quot; , , &quot;meiryo&quot; , &quot;ｍｓ ｐゴシック&quot; , &quot;ms pgothic&quot; , sans-serif; font-size: 15px;">&nbsp;など&nbsp;</span><code style="background: rgba(0, 0, 0, 0.03); border-radius: 3px; border: 1px solid rgba(0, 0, 0, 0.08); color: #4d4d4d; font-family: Monaco, Consolas, &quot;Courier New&quot;, Courier, monospace, sans-serif; font-size: 13.5px; margin: 0px 2px; outline: 0px; padding: 0px 5px; vertical-align: baseline;">kubectl</code><span style="background-color: white; color: #4d4d4d; font-family: &quot;titilliumtext22lregular&quot; , &quot;ヒラギノ角ゴ pro w3&quot; , &quot;hiragino kaku gothic pro&quot; , , &quot;meiryo&quot; , &quot;ｍｓ ｐゴシック&quot; , &quot;ms pgothic&quot; , sans-serif; font-size: 15px;">&nbsp;コマンドも使える模様。</span><br />
<span style="background-color: white; color: #4d4d4d; font-family: &quot;titilliumtext22lregular&quot; , &quot;ヒラギノ角ゴ pro w3&quot; , &quot;hiragino kaku gothic pro&quot; , , &quot;meiryo&quot; , &quot;ｍｓ ｐゴシック&quot; , &quot;ms pgothic&quot; , sans-serif; font-size: 15px;"><br /></span>
<span style="color: #4d4d4d; font-family: &quot;titilliumtext22lregular&quot; , &quot;pro w3&quot; , &quot;hiragino kaku gothic pro&quot; , , &quot;meiryo&quot; , , &quot;ms pgothic&quot; , sans-serif;"><span style="background-color: white; font-size: 15px;">コンテナを停止します</span></span><br />
<pre class="code console" data-lang="console" data-unlink="" style="background: rgb(250, 250, 250); border-radius: 3px; border: 0px; box-shadow: rgba(0, 0, 0, 0.2) 0px 0px 5px inset; color: #4d4d4d; font-family: Monaco, Consolas, &quot;Courier New&quot;, Courier, monospace, sans-serif; font-size: 13px; outline: 0px; overflow: auto hidden; padding: 10px; vertical-align: baseline;">$ docker stack rm --orchestrator=kubernetes <span style="font-family: &quot;monaco&quot; , &quot;consolas&quot; , &quot;courier new&quot; , &quot;courier&quot; , monospace , sans-serif; font-size: 13.5px; white-space: normal;">composek8s</span>
Removing stack: composek8s</pre>
